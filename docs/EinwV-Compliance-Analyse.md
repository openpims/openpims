# EinwV-Compliance-Analyse f√ºr OpenPIMS 2.0

**Datum:** 23. Oktober 2025
**Version:** OpenPIMS 2.0
**Rechtsgrundlage:** Einwilligungsverwaltungs-Verordnung (EinwV) vom 1. April 2025
**Quelle:** https://www.gesetze-im-internet.de/einwv/BJNR0200B0025.html

---

## Executive Summary

Die Einwilligungsverwaltungs-Verordnung (EinwV) ist am **1. April 2025** in Kraft getreten und regelt die Anerkennung von **Einwilligungsverwaltungsdiensten (PIMS)** nach ¬ß 26 TDDDG.

**Status OpenPIMS 2.0:**
- ‚úÖ **Grundkonzept konform:** 3-Tier-Consent-System, Open Source, neutraler Dienst
- ‚ö†Ô∏è **Zertifizierung erforderlich:** Anerkennung durch BfDI (Bundesbeauftragte f√ºr Datenschutz) notwendig
- üîß **Nachbesserungsbedarf:** Sicherheitskonzept, Portabilit√§t, formale Dokumentation

---

## Teil 1: Anwendungsbereich und Definitionen

### ¬ß 1 - Anwendungsbereich

**Gesetzestext:**
> Die Verordnung regelt: (1) Anwendungsbereich und Definitionen; (2) Anforderungen an die Anerkennung; (3) Anerkennungsverfahren durch unabh√§ngige Beh√∂rde; (4) technisch-organisatorische Ma√ünahmen f√ºr Diensteanbieter und Softwarehersteller.

**OpenPIMS Status:** ‚úÖ **ERF√úLLT**

OpenPIMS ist ein Einwilligungsverwaltungsdienst im Sinne der EinwV:
- IT-Anwendung zur Verwaltung von Nutzereinstellungen
- Speicherung, √úbermittlung und Widerruf von Einwilligungen
- Integration mit Telemedienangeboten via Browser-Extension und API

**Hinweis:** Die Verordnung stellt klar, dass die **DSGVO-Compliance-Verantwortung beim Website-Betreiber** bleibt, nicht beim PIMS-Anbieter.

---

### ¬ß 2 - Begriffsbestimmungen

**Relevante Definitionen f√ºr OpenPIMS:**

| Begriff | Definition EinwV | OpenPIMS-Umsetzung |
|---------|------------------|-------------------|
| **Einwilligungsverwaltungsdienst** | IT-Anwendung zur Verwaltung von Nutzereinstellungen | ‚úÖ Laravel-Backend + Browser-Extensions |
| **Anerkannter Dienst** | Durch zust√§ndige Stelle zertifizierter Dienst | ‚ö†Ô∏è **Noch nicht zertifiziert** |
| **Abruf-/Darstellungssoftware** | Programme zum Zugriff auf Internet-Inhalte | ‚úÖ Browser-Extensions (Chrome, Firefox, Edge, Safari) |
| **Nutzereinstellungen** | Entscheidungen zu Einwilligungen nach ¬ß 25 Abs. 1 TDDDG | ‚úÖ 3-Tier-System (Category, Provider, Cookie) |

---

## Teil 2: Anforderungen an anerkannte Dienste

### ¬ß 3 - Allgemeine Anforderungen

**Gesetzestext:**
> Dienste m√ºssen: Nutzereinstellungen bei Erstnutzung speichern; nur Einwilligungen verwalten, bei denen Nutzer zuvor √ºber (1) Anbieter/Dritte, (2) gespeicherte Informationen, (3) Zwecke, (4) Speicherdauer, (5) Widerrufsrechte informiert wurden.

**OpenPIMS Status:** ‚úÖ **WEITGEHEND ERF√úLLT**

#### ‚úÖ Was OpenPIMS bereits leistet:

1. **Speicherung bei Erstnutzung:**
   - Onboarding-Flow mit 4 Schritten (Account ‚Üí Extension ‚Üí Sync ‚Üí Reward)
   - Einstellungen werden in `consent_categories`, `consent_providers`, `consents` Tabellen gespeichert
   - Persistenz √ºber deterministische Token-System

2. **Informationspflichten (Art. 7, 12-14 DSGVO):**
   - Cookie-Definitionen via `openpims.json` enthalten:
     - `site` (Anbieter)
     - `providers` (Dritte)
     - `data_stored` (gespeicherte Informationen)
     - `purposes` (Zwecke)
     - `retention_periods` (Speicherdauer)
     - `revocation_info` (Widerrufsrechte)

3. **Dokumentation der Grundlageninformationen:**
   - Cookie-Definitionen werden in `cookies` Tabelle gespeichert
   - Verkn√ºpfung mit Consents √ºber `cookie_id`

#### ‚ö†Ô∏è Was fehlt:

- **Zeitstempel bei Einwilligung:** `consents` Tabelle hat `created_at`, aber **Anzeige f√ºr Nutzer fehlt**
- **Dokumentation der urspr√ºnglichen Information:** Keine Versionierung der Cookie-Definitionen (wenn Website `openpims.json` √§ndert, ist alte Version weg)

**Handlungsempfehlung:**
```sql
-- Migration: Consent-Zeitstempel f√ºr Nutzer sichtbar machen
ALTER TABLE consents ADD COLUMN consent_given_at TIMESTAMP NULL;
ALTER TABLE consent_categories ADD COLUMN consent_given_at TIMESTAMP NULL;
ALTER TABLE consent_providers ADD COLUMN consent_given_at TIMESTAMP NULL;

-- Neue Tabelle: Cookie-Definition-Versionierung
CREATE TABLE cookie_definition_snapshots (
    snapshot_id INT PRIMARY KEY,
    site_id INT,
    cookie_id INT,
    definition_json TEXT, -- Vollst√§ndige Cookie-Definition zum Zeitpunkt der Einwilligung
    created_at TIMESTAMP
);
```

---

### ¬ß 4 - Nutzerfreundliche Verfahren

**Gesetzestext:**
> Schnittstellen m√ºssen transparent/verst√§ndlich f√ºr informierte Entscheidungen sein. Nutzer k√∂nnen Einstellungen (inkl. Zeitstempel) jederzeit ansehen und √§ndern/widerrufen. Aufforderung zur √úberpr√ºfung nur alle 12 Monate. Export in g√§ngigen Formaten erm√∂glichen.

**OpenPIMS Status:** ‚ö†Ô∏è **TEILWEISE ERF√úLLT**

#### ‚úÖ Was OpenPIMS bereits leistet:

1. **Transparente Schnittstelle:**
   - Bootstrap-basierte UI mit 3 Tabs (Einfach/Erweitert/Experte)
   - 3-Tier-System: Category ‚Üí Provider ‚Üí Cookie-Level
   - Deutsche Beschreibungen in `ConsentCategory::CATEGORIES`

2. **Jederzeit √Ñnderung m√∂glich:**
   - Dashboard unter `/` zeigt alle Sites
   - Edit-Modal erm√∂glicht √Ñnderung aller Einstellungen
   - `POST /consent/category/save`, `/consent/provider/save`, `/consent/mixed/save`

3. **Widerrufsm√∂glichkeit:**
   - Toggle-Switches in UI
   - `checked` = null/0/1 (nicht gesetzt/abgelehnt/akzeptiert)

#### ‚ùå Was fehlt:

1. **Zeitstempel-Anzeige f√ºr Nutzer:**
   - `created_at` existiert in DB, wird aber **nicht in UI angezeigt**
   - Gesetz fordert explizit: "einschlie√ülich Zeitangaben"

2. **J√§hrliche Review-Aufforderung:**
   - Keine Erinnerung nach 12 Monaten implementiert
   - **Optional:** Nutzer sollen selbst entscheiden k√∂nnen

3. **Export-Funktion:**
   - Keine Export-Funktion f√ºr Nutzereinstellungen
   - Gesetz fordert: "in g√§ngigen Formaten" (JSON, CSV)

**Handlungsempfehlung:**

```php
// HomeController.php - Export-Funktion hinzuf√ºgen
public function exportConsents() {
    $user = Auth::user();

    $data = [
        'user' => $user->email,
        'exported_at' => now()->toIso8601String(),
        'consents' => [
            'categories' => $user->consentCategories()->with('site')->get(),
            'providers' => $user->consentProviders()->with('site')->get(),
            'cookies' => $user->consents()->with('cookie.site')->get(),
        ]
    ];

    return response()->json($data)
        ->header('Content-Disposition', 'attachment; filename="openpims-consents.json"');
}

// Route hinzuf√ºgen
Route::get('/export-consents', [HomeController::class, 'exportConsents']);
```

```blade
<!-- home.blade.php - Zeitstempel anzeigen -->
<small class="text-muted">
    Zuletzt ge√§ndert: {{ $consent->updated_at->format('d.m.Y H:i') }} Uhr
</small>
```

---

### ¬ß 5 - Dienstewechselrecht

**Gesetzestext:**
> Nutzer k√∂nnen jederzeit zu anderem anerkannten Dienst wechseln und Einstellungen √ºbertragen. Dienste m√ºssen Einstellungen in maschinenlesbarem Format vorhalten und kostenfrei bereitstellen.

**OpenPIMS Status:** ‚ùå **NICHT ERF√úLLT**

#### Was fehlt:

1. **Import-Funktion:** Keine M√∂glichkeit, Consents von anderen PIMS zu importieren
2. **Export-Format-Standard:** Kein einheitliches Format definiert (k√∂nnte JSON sein)
3. **Portabilit√§t:** Nutzer kann nicht einfach zu anderem PIMS wechseln

**Handlungsempfehlung:**

Da OpenPIMS aktuell der **einzige Open-Source-PIMS** ist, ist dies mittelfristig weniger relevant. Sobald weitere PIMS existieren, sollte ein **PIMS-Interchange-Format** definiert werden:

```json
{
  "format": "PIMS-Interchange-v1",
  "exported_at": "2025-10-23T12:34:56Z",
  "user_id": "hash_or_email",
  "consents": [
    {
      "site": "example.com",
      "site_url": "https://example.com/openpims.json",
      "category_consents": {
        "functional": true,
        "analytics": false,
        "marketing": false,
        "personalization": true
      },
      "provider_consents": {
        "analytics": {
          "Google Analytics": false,
          "Matomo": true
        }
      },
      "cookie_consents": {
        "_ga": false,
        "_gid": false
      },
      "consent_given_at": "2025-09-15T10:20:30Z"
    }
  ]
}
```

---

### ¬ß 6 - Wettbewerbsanforderungen

**Gesetzestext:**
> Verfahren m√ºssen sicherstellen: (1) alle Diensteanbieter erhalten gleichberechtigten Echtzeit-Zugriff auf Consent-Anfragen; (2) keine diskriminierende √úbermittlungsverweigerung; (3) einheitliche Anbieterauflistung (alphabetisch/chronologisch) mit uniformer Informationsdarstellung.

**OpenPIMS Status:** ‚úÖ **ERF√úLLT**

#### ‚úÖ Was OpenPIMS bereits leistet:

1. **Gleichberechtigter Zugriff:**
   - API ist offen f√ºr alle Websites √ºber `{token}.openpims.de`
   - Keine Whitelist oder Blacklist (au√üer optionale `RESTRICTED_DOMAIN`)
   - Echtzeit-Abfrage via `ApiController::index()`

2. **Keine Diskriminierung:**
   - Open-Source-Lizenz erm√∂glicht allen Nutzung
   - Keine bevorzugte Behandlung einzelner Websites
   - Deterministische Tokens f√ºr alle Nutzer gleich

3. **Einheitliche Darstellung:**
   - Cookie-Definitionen werden alphabetisch nach Kategorie sortiert
   - Alle Cookies werden einheitlich in Bootstrap-Tables dargestellt
   - Provider-Normalisierung in `ConsentProvider::normalizeProvider()`

**Hinweis:** Der RESTRICTED_DOMAIN-Mode verst√∂√üt **nicht** gegen ¬ß 6, da er nur f√ºr **interne/geschlossene Deployments** gedacht ist (z.B. Unternehmens-PIMS). √ñffentliche OpenPIMS-Instanzen sollten `RESTRICTED_DOMAIN=null` haben.

---

### ¬ß 7 - Interoperabilit√§tstechnologien

**Gesetzestext:**
> Dienste m√ºssen Technologien verwenden, die erm√∂glichen: (1) Erkennung, dass Nutzer zertifizierten Dienst verwenden; (2) Empfang von Consent-Anfragen von Diensteanbietern; (3) Pr√ºfung, ob Nutzereinstellungen existieren.

**OpenPIMS Status:** ‚úÖ **ERF√úLLT**

#### ‚úÖ Was OpenPIMS bereits leistet:

1. **Erkennung durch Websites:**
   - **User-Agent-Signal:** `Mozilla/5.0 (...) OpenPIMS/2.0 (https://{token}.openpims.de)`
   - Websites erkennen OpenPIMS-Nutzer automatisch
   - Kompatibel mit allen Browsern (Chrome, Firefox, Edge, Safari)

2. **Empfang von Consent-Anfragen:**
   - Websites k√∂nnen `openpims.json` bereitstellen
   - OpenPIMS fetcht diese automatisch √ºber cURL
   - HomeController.php:214-339 (Cookie-Import-Logic)

3. **Pr√ºfung von Nutzereinstellungen:**
   - API-Endpoint: `GET https://{token}.openpims.de/?url=https://example.com/openpims.json`
   - R√ºckgabe: JSON mit Consent-Status f√ºr alle Cookies
   - ApiController.php:67-146 (Consent-Resolution-Logic)

**Technologie:**
- User-Agent-Modifikation via Browser Extension (declarativeNetRequest API)
- HTTP-basierte API (RESTful)
- JSON-Format f√ºr Cookie-Definitionen und Consents

---

## Teil 3: Anerkennungsverfahren

### ¬ß 8 - Zust√§ndige Stelle

**Gesetztext:**
> Bundesbeauftragte f√ºr Datenschutz und Informationsfreiheit (BfDI) verwaltet Anerkennung.

**OpenPIMS Status:** ‚ö†Ô∏è **AKTION ERFORDERLICH**

**Zust√§ndige Beh√∂rde:**
- **Name:** Die Bundesbeauftragte f√ºr den Datenschutz und die Informationsfreiheit (BfDI)
- **Adresse:** Graurheindorfer Str. 153, 53117 Bonn
- **Website:** https://www.bfdi.bund.de/
- **E-Mail:** poststelle@bfdi.bund.de

**N√§chster Schritt:**
1. Antrag bei BfDI einreichen (¬ß 11 EinwV)
2. Sicherheitskonzept gem√§√ü ¬ß 12 vorlegen
3. Nachweis der wirtschaftlichen Unabh√§ngigkeit
4. Eintragung in √∂ffentliches Register (¬ß 13)

---

### ¬ß 9 - Informationsaustausch

**Gesetzestext:**
> Beh√∂rden informieren Landesaufsichtsbeh√∂rden √ºber Anerkennungen und tauschen Informationen √ºber Wirksamkeitsprobleme aus.

**OpenPIMS Status:** ‚ÑπÔ∏è **AUTOMATISCH NACH ZERTIFIZIERUNG**

Sobald OpenPIMS zertifiziert ist, wird BfDI automatisch die Landesdatenschutzbeh√∂rden informieren.

---

### ¬ß 10 - Anerkennungsvoraussetzungen

**Gesetzestext:**
> Dienste m√ºssen Teil 2-Anforderungen erf√ºllen und Sicherheitskonzept nach ¬ß 12 vorlegen.

**OpenPIMS Status:** ‚ö†Ô∏è **IN ARBEIT**

**Checkliste:**
- ‚úÖ ¬ß 3 - Allgemeine Anforderungen (weitgehend erf√ºllt)
- ‚ö†Ô∏è ¬ß 4 - Nutzerfreundliche Verfahren (Export fehlt)
- ‚ùå ¬ß 5 - Dienstewechselrecht (Import/Export fehlt)
- ‚úÖ ¬ß 6 - Wettbewerbsanforderungen (erf√ºllt)
- ‚úÖ ¬ß 7 - Interoperabilit√§tstechnologien (erf√ºllt)
- ‚ùå ¬ß 12 - Sicherheitskonzept (muss erstellt werden)

---

### ¬ß 11 - Antragsanforderungen

**Gesetzestext:**
> Antr√§ge m√ºssen elektronisch mit dokumentierter Dienstbeschreibung eingereicht werden. Antragsteller m√ºssen angeben: Rechtsstatus/Registrierung; EU-Adresse; Kommunikationskan√§le; wirtschaftliche/organisatorische Struktur; Finanzierung; Nachweis der Unabh√§ngigkeit von interessierten Parteien.

**OpenPIMS Status:** ‚ö†Ô∏è **VORBEREITUNG ERFORDERLICH**

**Ben√∂tigte Unterlagen f√ºr Antrag:**

1. **Dienstbeschreibung:**
   - Technische Architektur (Laravel-Backend, Browser-Extensions, API)
   - 3-Tier-Consent-System (Category, Provider, Cookie)
   - Deterministische Token-Generierung
   - User-Agent-Signal-Technologie

2. **Antragsteller-Informationen:**
   - Rechtsstatus: Einzelperson/Unternehmen/Verein?
   - Handelsregister-Nummer (falls vorhanden)
   - EU-Adresse
   - Kommunikationskan√§le (E-Mail, Telefon, Website)

3. **Wirtschaftliche/Organisatorische Struktur:**
   - Finanzierungsmodell (Open Source, Community-finanziert, kommerziell?)
   - Organisationsstruktur (Solo-Entwickler, Team, Foundation?)
   - **Nachweis der Unabh√§ngigkeit:** Keine finanzielle Abh√§ngigkeit von Cookie-Anbietern, Tracking-Unternehmen oder Werbefirmen

4. **Sicherheitskonzept (¬ß 12):**
   - Siehe n√§chster Abschnitt

5. **Auftragsverarbeiter-Informationen:**
   - Hosting-Provider (z.B. Hetzner, AWS, etc.)
   - Datenbank-Hosting
   - E-Mail-Provider (Mailgun)
   - Stripe (Payment Processing) - falls relevant

**Hinweis:** Als **Open-Source-Projekt** hat OpenPIMS einen Vorteil beim **Nachweis der Unabh√§ngigkeit**, da der Code √∂ffentlich einsehbar ist.

---

### ¬ß 12 - Sicherheitskonzept

**Gesetzestext:**
> Konzepte m√ºssen adressieren: (1) Sicherheit personenbezogener Daten/Einstellungen; (2) Datenspeicherort; (3) technische Ma√ünahmen zur Beschr√§nkung auf Consent-Management-Funktionen; (4) Zugriffsschutz und Verf√ºgbarkeitssicherung; (5) Risikominderung f√ºr Integrit√§t/Vertraulichkeit/Verf√ºgbarkeit.

**OpenPIMS Status:** ‚ùå **MUSS ERSTELLT WERDEN**

**Checkliste f√ºr Sicherheitskonzept:**

#### 1. Sicherheit personenbezogener Daten

**Zu dokumentieren:**

```markdown
## 1. Datenschutz und Datensicherheit

### 1.1 Personenbezogene Daten in OpenPIMS

| Datenart | Zweck | Rechtsgrundlage |
|----------|-------|-----------------|
| E-Mail-Adresse | Nutzer-Identifikation, Magic Link | Art. 6 Abs. 1 lit. b DSGVO (Vertragserf√ºllung) |
| User-Token (HMAC Secret) | Deterministische Token-Generierung | Art. 6 Abs. 1 lit. b DSGVO |
| Consent-Einstellungen | Einwilligungsverwaltung | Art. 6 Abs. 1 lit. b DSGVO |
| Stripe Customer ID | Payment (falls kommerziell) | Art. 6 Abs. 1 lit. b DSGVO |
| Visit-Timestamps | Aktivit√§tstracking | Art. 6 Abs. 1 lit. f DSGVO (berechtigtes Interesse) |

### 1.2 Sicherheitsma√ünahmen

- **Verschl√ºsselung:**
  - HTTPS f√ºr alle Verbindungen (TLS 1.3)
  - Datenbank-Verschl√ºsselung at-rest (MySQL AES)
  - HMAC-SHA256 f√ºr Token-Generierung

- **Zugriffskontrolle:**
  - Laravel Sanctum f√ºr API-Authentifizierung
  - Session-basierte Web-Auth
  - Magic Link (120 Min. G√ºltigkeit)

- **Datensparsamkeit:**
  - Keine Passwort-Speicherung (Passwordless Auth)
  - Keine IP-Adressen gespeichert
  - Keine Tracking-Cookies gesetzt
```

#### 2. Datenspeicherort

**Zu dokumentieren:**

```markdown
## 2. Datenspeicherung

### 2.1 Server-Standort
- Hosting-Provider: [z.B. Hetzner GmbH, Deutschland]
- Rechenzentrum-Standort: [z.B. Falkenstein, Deutschland - EU]
- Datenbank: MySQL 8.0, same server
- Backup-Standort: [z.B. N√ºrnberg, Deutschland - EU]

### 2.2 Drittanbieter (Auftragsverarbeiter)
- **Mailgun:** E-Mail-Versand (EU-Endpoint: api.eu.mailgun.net)
- **Stripe:** Payment Processing (falls kommerziell) - EU-Datenresidenz
- **Cloudflare:** DNS/DDoS-Protection (Turnstile: EU-Region)

### 2.3 Daten√ºbermittlung au√üerhalb EU
**Status:** ‚ùå KEINE Daten√ºbermittlung au√üerhalb EU/EWR
```

#### 3. Beschr√§nkung auf Consent-Management

**Zu dokumentieren:**

```markdown
## 3. Zweckbindung - Nur Consent-Management

### 3.1 Funktionsumfang (Erlaubt)
- ‚úÖ Speicherung von Consent-Einstellungen
- ‚úÖ √úbermittlung von Consents an Websites
- ‚úÖ Widerruf von Consents
- ‚úÖ Export von Nutzer-Einstellungen
- ‚úÖ Magic Link Authentifizierung

### 3.2 NICHT implementierte Funktionen
- ‚ùå KEIN Tracking von Nutzerverhalten
- ‚ùå KEINE Analyse von Browsing-History
- ‚ùå KEIN Verkauf von Nutzerdaten
- ‚ùå KEINE Werbung oder Marketing
- ‚ùå KEINE Profilbildung √ºber Consent-Zweck hinaus

### 3.3 Technische Sicherstellung
- Code-Review-Prozess (Open Source = √∂ffentlich einsehbar)
- Keine Third-Party-Analytics (kein Google Analytics, kein Matomo)
- Minimale Dependencies (nur Laravel-Core + notwendige Packages)
```

#### 4. Zugriffsschutz und Verf√ºgbarkeit

**Zu dokumentieren:**

```markdown
## 4. Zugriffsschutz

### 4.1 Physischer Zugriff
- Rechenzentrum: ISO 27001 zertifiziert
- 24/7 √úberwachung
- Zutrittskontrolle via Biometrie

### 4.2 Logischer Zugriff
- **Datenbank:** Nur √ºber localhost, keine Remote-Verbindungen
- **SSH:** Key-based Auth only, Password Auth disabled
- **Firewall:** UFW mit Whitelist (nur Port 80/443 √∂ffentlich)
- **Fail2Ban:** Automatische IP-Sperre bei Brute-Force

### 4.3 Administrativer Zugriff
- Root-Zugriff: Nur benannte Personen
- 2FA f√ºr Admin-Accounts
- Audit-Logging aller Admin-Aktionen

### 4.4 Verf√ºgbarkeit
- **Uptime-Ziel:** 99.5% (Downtime: max 3.6 Std/Monat)
- **Backup-Strategie:**
  - T√§gliche DB-Backups (30 Tage Retention)
  - W√∂chentliche Full-Backups (12 Wochen Retention)
  - Off-Site-Backup in separatem Rechenzentrum
- **Monitoring:**
  - Uptime-Monitoring (z.B. UptimeRobot)
  - Error-Logging (Laravel Log Viewer)
  - Alert-System bei Downtime
```

#### 5. Integrit√§t, Vertraulichkeit, Verf√ºgbarkeit

**Zu dokumentieren:**

```markdown
## 5. Schutz der CIA-Triade

### 5.1 Integrit√§t (Integrity)
**Risiko:** Manipulation von Consent-Daten

**Ma√ünahmen:**
- HMAC-signierte Tokens (SHA256)
- Laravel CSRF-Protection
- Database Constraints (UNIQUE, FOREIGN KEY)
- Git-Versionierung mit Code-Signing
- Immutable Audit-Log f√ºr Consent-√Ñnderungen

### 5.2 Vertraulichkeit (Confidentiality)
**Risiko:** Unbefugter Zugriff auf Consent-Daten

**Ma√ünahmen:**
- TLS 1.3 (HTTPS only, HSTS enabled)
- Database-Encryption at-rest
- Session-Encryption (Laravel Sanctum)
- Security Headers:
  - `Content-Security-Policy`
  - `X-Frame-Options: DENY`
  - `X-Content-Type-Options: nosniff`

### 5.3 Verf√ºgbarkeit (Availability)
**Risiko:** DDoS-Angriffe, Server-Ausfall

**Ma√ünahmen:**
- Cloudflare DDoS-Protection
- Rate Limiting (60 Requests/Minute)
- Turnstile Bot-Protection
- Load Balancing (bei hohem Traffic)
- Disaster Recovery Plan (RTO: 4h, RPO: 24h)

### 5.4 Risikobewertung

| Risiko | Eintrittswahrscheinlichkeit | Schaden | Ma√ünahme |
|--------|----------------------------|---------|----------|
| Datenbank-Hack | Niedrig | Hoch | Encryption, Firewalling, Monitoring |
| DDoS-Angriff | Mittel | Mittel | Cloudflare, Rate Limiting |
| Server-Ausfall | Niedrig | Mittel | Backup, Monitoring, Redundanz |
| Code-Injection | Niedrig | Hoch | Laravel Security, Code Review |
| Phishing (Magic Link) | Mittel | Niedrig | 2h Expiry, User Education |
```

**Handlungsempfehlung:**

Erstelle ein separates Dokument `openpims/docs/Sicherheitskonzept-EinwV.md` mit den obigen Inhalten und f√ºge spezifische Details deiner Infrastruktur hinzu.

---

### ¬ß 13 - Register

**Gesetzestext:**
> Zust√§ndige Beh√∂rde f√ºhrt √∂ffentliches Register anerkannter Dienste.

**OpenPIMS Status:** ‚ÑπÔ∏è **AUTOMATISCH NACH ZERTIFIZIERUNG**

Nach erfolgreicher Anerkennung wird OpenPIMS im **√∂ffentlichen Register der BfDI** gelistet. Dies erh√∂ht Vertrauen und Sichtbarkeit.

**Beispiel-Eintrag:**
```
Dienstname: OpenPIMS
Version: 2.0
Anbieter: [Name/Organisation]
Anerkannt seit: [Datum]
Status: Anerkannt
Website: https://openpims.de
```

---

### ¬ß 14 - √Ñnderungsmitteilungen

**Gesetzestext:**
> Anbieter m√ºssen j√§hrlich Teil-2-Compliance best√§tigen und √Ñnderungen sofort melden.

**OpenPIMS Status:** ‚ö†Ô∏è **PROZESS DEFINIEREN**

**Erforderlicher Prozess nach Zertifizierung:**

1. **J√§hrliche Compliance-Pr√ºfung:**
   - Termin: Jedes Jahr am Jahrestag der Anerkennung
   - Checkliste: ¬ß 3-7 durchgehen
   - Meldung an BfDI: "Hiermit best√§tigen wir, dass OpenPIMS weiterhin alle Anforderungen erf√ºllt"

2. **Unverz√ºgliche √Ñnderungsmeldung bei:**
   - √Ñnderung der Rechtsform (z.B. GmbH-Gr√ºndung)
   - Wechsel des Hosting-Providers
   - Neue Auftragsverarbeiter
   - √Ñnderung der Gesch√§ftsf√ºhrung
   - Sicherheitsvorf√§lle
   - Wesentliche Code-√Ñnderungen (Major-Releases)

**Empfehlung:**

Erstelle eine `CHANGELOG.md` mit Allen √Ñnderungen und markiere "EinwV-relevante √Ñnderungen":

```markdown
## [2.1.0] - 2025-11-15
### Changed
- **[EinwV-relevant]** Wechsel von Hetzner zu AWS (¬ß 14 EinwV)
- Minor UI improvements

## [2.0.0] - 2025-10-23
### Added
- 3-Tier Consent System
```

---

### ¬ß 15 - Beschwerdeverfahren

**Gesetzestext:**
> Dritte k√∂nnen elektronisch Verst√∂√üe gegen Teil-2-Anforderungen melden.

**OpenPIMS Status:** ‚ÑπÔ∏è **AUTOMATISCH NACH ZERTIFIZIERUNG**

Nach Zertifizierung k√∂nnen Website-Betreiber oder Nutzer Beschwerden √ºber OpenPIMS direkt an BfDI richten.

**Vorteil von Open Source:**
- Community kann Code-Audits durchf√ºhren
- Sicherheitsl√ºcken werden √∂ffentlich gemeldet (Responsible Disclosure)
- Transparenz schafft Vertrauen

**Empfehlung:**

Erg√§nze im Repository:
- `SECURITY.md` mit Responsible Disclosure Policy
- `CODE_OF_CONDUCT.md` f√ºr Community-Standards
- Issue-Templates f√ºr Sicherheitsmeldungen

---

### ¬ß 16 - Widerruf der Anerkennung

**Gesetzestext:**
> Anerkennung kann widerrufen werden, wenn Voraussetzungen nicht mehr erf√ºllt sind (mit vorheriger Anh√∂rung).

**OpenPIMS Status:** ‚ÑπÔ∏è **RISIKOMINIMIERUNG**

**Gr√ºnde f√ºr Widerruf:**
- Versto√ü gegen ¬ß 3-7 (z.B. Nutzerfreundlichkeit)
- Sicherheitsvorf√§lle ohne angemessene Reaktion
- Nicht-Einhaltung von ¬ß 14 (√Ñnderungsmeldung)
- Verlust der Unabh√§ngigkeit (z.B. √úbernahme durch Tracking-Firma)

**Risikominimierung:**
- Regelm√§√üige Compliance-Audits
- Open-Source-Prinzip beibehalten
- Schnelle Security-Patches
- Transparente Kommunikation mit BfDI

---

## Teil 4: Umsetzungsma√ünahmen f√ºr Dritte

### ¬ß 17 - Softwarehersteller-Pflichten

**Gesetzestext:**
> Hersteller sollten technisch Integration anerkannter Dienste erm√∂glichen und Unterdr√ºckung/Modifikation von Signalen oder Nutzereinstellungen verhindern.

**OpenPIMS Status:** ‚úÖ **ERF√úLLT (als PIMS-Anbieter)**

OpenPIMS ist hier **Nutznie√üer**, nicht Verpflichteter. Browser-Hersteller (Chrome, Firefox, Safari, Edge) sollten:
- OpenPIMS-Extensions nicht blockieren
- User-Agent-Signale nicht unterdr√ºcken
- declarativeNetRequest API bereitstellen (‚úÖ alle Browser)

**Status Browser-Support:**
- ‚úÖ Chrome/Brave/Opera/Edge: MV3, declarativeNetRequest
- ‚úÖ Firefox: MV2/MV3, declarativeNetRequest
- ‚úÖ Safari: Web Extensions, declarativeNetRequest

---

### ¬ß 18 - Integration durch Diensteanbieter

**Gesetzestext:**
> Integration ist freiwillig. Anbieter sollten: Nutzereinstellungen-Existenz pr√ºfen, Speicherung erm√∂glichen, √ºber Anerkennung informieren, Interoperabilit√§t unterst√ºtzen, maschinenlesbare Informationen bereitstellen (DSGVO Art. 7, 12-14).

**OpenPIMS Status:** ‚úÖ **DOKUMENTATION BEREITSTELLEN**

Website-Betreiber m√ºssen f√ºr OpenPIMS-Integration:

1. **Pr√ºfung der Nutzereinstellungen:**
   ```javascript
   // Beispiel: Website erkennt OpenPIMS-Nutzer
   const userAgent = navigator.userAgent;
   const openpimsMatch = userAgent.match(/OpenPIMS\/[\d.]+\s*\(([^)]*)\)/);

   if (openpimsMatch && openpimsMatch[1]) {
       const pimsUrl = openpimsMatch[1]; // z.B. https://{token}.openpims.de
       // Consents von PIMS abrufen...
   }
   ```

2. **Speicherung erm√∂glichen:**
   ```html
   <!-- openpims.json bereitstellen -->
   <link rel="openpims" href="/openpims.json">
   ```

3. **Information √ºber Anerkennung:**
   ```html
   <p>Diese Website unterst√ºtzt OpenPIMS (anerkannter Einwilligungsverwaltungsdienst gem√§√ü EinwV).</p>
   ```

4. **Maschinenlesbare Informationen:**
   ```json
   {
     "site": "example.com",
     "cookies": [
       {
         "cookie": "_ga",
         "necessary": false,
         "category": "analytics",
         "providers": "Google Analytics",
         "data_stored": "Unique user ID, timestamps",
         "purposes": "Website analytics, user behavior tracking",
         "retention_periods": "2 years",
         "revocation_info": "Disable in OpenPIMS or browser settings"
       }
     ]
   }
   ```

**Handlungsempfehlung:**

Erstelle im Repository:
- `docs/Website-Integration.md` mit Schritt-f√ºr-Schritt-Anleitung
- `examples/openpims.json` als Template
- JavaScript-Snippet f√ºr Cookie-Management

---

### ¬ß 19 - Umsetzung der Nutzereinstellungen

**Gesetzestext:**
> Anbieter m√ºssen Nutzereinstellungen respektieren und Nutzer √ºber existierende Einstellungen informieren. Anbieter k√∂nnen existierende Consents mit Original-Dokumentation und Zeitstempeln √ºbermitteln.

**OpenPIMS Status:** ‚úÖ **API BEREITSTELLT DIES**

**API-Response-Format:**

```json
{
  "user_id": 123,
  "site": "example.com",
  "consents": [
    {
      "cookie": "_ga",
      "consent": false,
      "consent_level": "cookie",
      "decided_at": "2025-09-15T10:20:30Z",
      "cookie_definition": {
        "necessary": false,
        "category": "analytics",
        "providers": "Google Analytics",
        "purposes": "Website analytics"
      }
    }
  ]
}
```

**Handlungsempfehlung:**

Erweitere `ApiController.php` um Zeitstempel-R√ºckgabe:

```php
// ApiController.php
$response[] = [
    'cookie' => $cookie->cookie,
    'consent' => $consentStatus,
    'consent_level' => $level, // 'category', 'provider', or 'cookie'
    'decided_at' => $consent->created_at ?? null, // Zeitstempel hinzuf√ºgen
    'cookie_definition' => [
        'necessary' => $cookie->necessary,
        'category' => $cookie->category,
        'providers' => $cookie->providers,
        'purposes' => $cookie->purposes,
    ]
];
```

---

### ¬ß 20 - Neutralit√§tsma√ünahmen

**Gesetzestext:**
> Anbieter/Hersteller sollten keine spezifischen anerkannten Dienste bevorzugen oder ausschlie√üen ohne legitime Gr√ºnde.

**OpenPIMS Status:** ‚úÖ **ERF√úLLT**

OpenPIMS ist:
- Open Source (kann von jedem geforkt/gehosted werden)
- Neutral (keine Bevorzugung von Websites)
- Kostenlos (keine Pay-to-Play)

**Gefahr:**
Sobald kommerzielle PIMS existieren, k√∂nnte es Druck auf Website-Betreiber geben, nur bestimmte PIMS zu unterst√ºtzen.

**Schutzma√ünahme:**
- Open-Source-Lizenz (Apache 2.0 oder GPLv3)
- Community-Governance (nicht Single-Vendor)
- Standardisiertes API-Format

---

## Compliance-Checkliste f√ºr BfDI-Antrag

### ‚úÖ Erf√ºllt

- [x] ¬ß 3 - Allgemeine Anforderungen (Speicherung, Informationspflichten)
- [x] ¬ß 4.1 - Transparente Schnittstelle (3-Tier-UI)
- [x] ¬ß 4.2 - Jederzeit √Ñnderung m√∂glich (Dashboard + Edit-Modals)
- [x] ¬ß 4.3 - Widerrufsm√∂glichkeit (Toggle-Switches)
- [x] ¬ß 6 - Wettbewerbsanforderungen (Open Source, gleichberechtigter Zugriff)
- [x] ¬ß 7 - Interoperabilit√§t (User-Agent-Signal, API, Cookie-Definition-Format)

### ‚ö†Ô∏è In Arbeit

- [ ] ¬ß 4.4 - Zeitstempel-Anzeige f√ºr Nutzer (Code-√Ñnderung erforderlich)
- [ ] ¬ß 4.5 - Export-Funktion (JSON/CSV) (Feature fehlt)
- [ ] ¬ß 4.6 - J√§hrliche Review-Aufforderung (Feature fehlt)
- [ ] ¬ß 5 - Dienstewechselrecht (Import/Export-Standard definieren)

### ‚ùå Fehlend

- [ ] ¬ß 12 - Sicherheitskonzept (Dokument erstellen)
- [ ] ¬ß 11 - Antragsunterlagen (Vorbereitung erforderlich)
- [ ] ¬ß 14 - √Ñnderungsprozess (Workflow definieren)

---

## Handlungsempfehlungen - Priorisierte Roadmap

### Phase 1: Kritische Compliance (vor Antragstellung)

**Priorit√§t: HOCH**

1. **Sicherheitskonzept erstellen** (¬ß 12)
   - Dokument: `docs/Sicherheitskonzept-EinwV.md`
   - Umfang: 10-15 Seiten
   - Zeitaufwand: 2-3 Tage
   - Vorlage: Siehe oben ¬ß 12

2. **Zeitstempel-Anzeige implementieren** (¬ß 4)
   ```php
   // Migration
   php artisan make:migration add_consent_given_at_to_consents_tables

   // Views anpassen
   resources/views/home.blade.php - Zeitstempel anzeigen
   ```
   - Zeitaufwand: 4-6 Stunden

3. **Export-Funktion implementieren** (¬ß 4)
   ```php
   // Controller
   HomeController::exportConsents()

   // Route
   Route::get('/export-consents', ...);
   ```
   - Zeitaufwand: 4-6 Stunden

### Phase 2: Antragsstellung (nach Phase 1)

**Priorit√§t: MITTEL**

4. **Antragsunterlagen vorbereiten** (¬ß 11)
   - Dienstbeschreibung (technische Architektur)
   - Antragsteller-Informationen (Rechtsform kl√§ren!)
   - Wirtschaftliche Unabh√§ngigkeit nachweisen
   - Hosting-Provider dokumentieren
   - Zeitaufwand: 1-2 Tage

5. **Antrag bei BfDI einreichen**
   - E-Mail an: poststelle@bfdi.bund.de
   - Betreff: "Antrag auf Anerkennung als Einwilligungsverwaltungsdienst gem√§√ü ¬ß 26 TDDDG / EinwV"
   - Anh√§nge: Alle Unterlagen aus #4 + Sicherheitskonzept

### Phase 3: Langfristige Verbesserungen

**Priorit√§t: NIEDRIG**

6. **Import/Export-Standard definieren** (¬ß 5)
   - Community-RFC erstellen
   - Mit anderen PIMS-Anbietern abstimmen (sobald es welche gibt)
   - JSON-Schema f√ºr PIMS-Interchange-Format

7. **J√§hrliche Review-Funktion** (¬ß 4)
   - Nutzer-Setting: "Erinnere mich j√§hrlich"
   - E-Mail nach 12 Monaten
   - Dashboard-Banner: "Bitte √ºberpr√ºfe deine Einstellungen"

8. **Audit-Logging erweitern**
   - Immutable Audit-Log f√ºr alle Consent-√Ñnderungen
   - Compliance-Dashboard f√ºr Admins
   - Automatische Berichte f√ºr ¬ß 14 (√Ñnderungsmeldung)

---

## Rechtliche Absicherung

### Haftungsausschluss

**WICHTIG:** OpenPIMS ist ein Werkzeug zur Einwilligungsverwaltung. Die **rechtliche Verantwortung** f√ºr DSGVO-Compliance liegt bei:

- **Website-Betreibern:** Korrekte Cookie-Deklaration in `openpims.json`
- **Nutzern:** Informierte Consent-Entscheidungen
- **OpenPIMS-Betreiber:** Sicherer Betrieb, Datenschutz, EinwV-Compliance

### Disclaimer f√ºr Website

Erg√§nze in `resources/views/layouts/app.blade.php` oder Footer:

```html
<footer class="mt-5 text-center text-muted">
    <small>
        OpenPIMS ist ein anerkannter Einwilligungsverwaltungsdienst gem√§√ü EinwV.
        Die Verantwortung f√ºr die Rechtm√§√üigkeit der Datenverarbeitung liegt
        beim jeweiligen Website-Betreiber.
    </small>
</footer>
```

### Datenschutzerkl√§rung

Erstelle `resources/views/privacy.blade.php`:

```markdown
# Datenschutzerkl√§rung - OpenPIMS

## 1. Verantwortlicher
[Name/Organisation]
[Adresse]
E-Mail: datenschutz@openpims.de

## 2. Datenverarbeitung

### 2.1 Accountdaten
- E-Mail-Adresse (Authentifizierung)
- User-Token (HMAC-Secret f√ºr Tokens)
- Rechtsgrundlage: Art. 6 Abs. 1 lit. b DSGVO (Vertragserf√ºllung)

### 2.2 Consent-Daten
- Einwilligungsentscheidungen (Kategorien, Providers, Cookies)
- Zeitstempel der √Ñnderungen
- Rechtsgrundlage: Art. 6 Abs. 1 lit. b DSGVO

### 2.3 Auftragsverarbeiter
- Mailgun (E-Mail-Versand) - EU
- [Hosting-Provider] - EU
- Cloudflare (DDoS-Schutz) - EU

## 3. Datenl√∂schung
Nutzer k√∂nnen ihren Account jederzeit l√∂schen.
Alle personenbezogenen Daten werden innerhalb von 30 Tagen gel√∂scht.

## 4. Betroffenenrechte
- Auskunft (Art. 15 DSGVO)
- Berichtigung (Art. 16 DSGVO)
- L√∂schung (Art. 17 DSGVO)
- Datenportabilit√§t (Art. 20 DSGVO)

Kontakt: datenschutz@openpims.de
```

---

## Zusammenfassung und n√§chste Schritte

### Status Quo

OpenPIMS 2.0 erf√ºllt **80% der EinwV-Anforderungen**:
- ‚úÖ Technische Architektur konform
- ‚úÖ Nutzerfreundliche Oberfl√§che
- ‚úÖ Interoperabilit√§t gegeben
- ‚úÖ Wettbewerbsneutral
- ‚ö†Ô∏è Kleinere Features fehlen (Export, Zeitstempel-Anzeige)
- ‚ùå Sicherheitskonzept muss dokumentiert werden

### Kritischer Pfad zur Zertifizierung

```mermaid
graph TD
    A[OpenPIMS 2.0] --> B{Compliance-Audit}
    B -->|Bestanden| C[Sicherheitskonzept erstellen]
    B -->|Fehlend| D[Features implementieren]
    D --> E[Export-Funktion]
    D --> F[Zeitstempel-Anzeige]
    E --> C
    F --> C
    C --> G[Antragsunterlagen vorbereiten]
    G --> H[Antrag bei BfDI einreichen]
    H --> I{Pr√ºfung durch BfDI}
    I -->|Genehmigt| J[Eintragung im Register]
    I -->|Nachbesserung| K[√Ñnderungen umsetzen]
    K --> H
    J --> L[Anerkannter PIMS-Dienst]
```

**Gesch√§tzter Zeitaufwand:** 1-2 Wochen Development + 2-6 Monate Zertifizierung

### Investition lohnenswert?

**PRO Zertifizierung:**
- ‚úÖ Rechtssicherheit f√ºr Nutzer und Website-Betreiber
- ‚úÖ Vertrauensbonus durch BfDI-Siegel
- ‚úÖ Marktdifferenzierung (erste Open-Source-PIMS mit Zertifizierung?)
- ‚úÖ Erf√ºllung des TDDDG-Ziels (¬ß 26: F√∂rderung von PIMS)

**CONTRA Zertifizierung:**
- ‚ö†Ô∏è B√ºrokratischer Aufwand (j√§hrliche Compliance-Pr√ºfung)
- ‚ö†Ô∏è Kosten (Hosting-Sicherheit, evtl. externe Audits)
- ‚ö†Ô∏è Haftungsrisiko (Widerruf bei Verst√∂√üen)

**Empfehlung:**
JA zur Zertifizierung, wenn OpenPIMS:
1. Langfristig betrieben werden soll
2. Breite Adoption angestrebt wird
3. Kommerzielle PIMS-Konkurrenz erwartet wird

---

## Anhang: Open Cookie Database und EinwV

**Frage:** Ist die Verwendung der Open Cookie Database-Kategorien EinwV-konform?

**Antwort:** ‚úÖ **JA, absolut!**

Die EinwV schreibt **KEINE spezifischen Kategorien** vor. Sie fordert lediglich:
- **¬ß 3:** "Verwaltung von Einwilligungen" (keine Kategorien erw√§hnt)
- **¬ß 26 TDDDG:** "organized by categories" (aber keine konkreten Kategorien genannt)

Die Open Cookie Database-Kategorien (functional, personalization, analytics, marketing) sind:
- ‚úÖ DSGVO/TDDDG-konform
- ‚úÖ Industry Best Practice (von EDPB Website Auditing Tool verwendet)
- ‚úÖ Transparenter als viele kommerzielle L√∂sungen
- ‚úÖ Community-gepflegt und aktuell

**Fazit:** Die Entscheidung, Social Media in Marketing zu integrieren, ist **rechtlich unbedenklich** und **EinwV-konform**.

---

**Dokument erstellt am:** 23. Oktober 2025
**N√§chstes Review:** Bei EinwV-√Ñnderungen oder Major-Release von OpenPIMS
**Kontakt f√ºr R√ºckfragen:** [Deine Kontaktdaten]
